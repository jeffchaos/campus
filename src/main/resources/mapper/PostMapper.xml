<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.campus.mapper.PostMapper">
  <resultMap id="BaseResultMap" type="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    <id column="PostId" jdbcType="INTEGER" property="postid" />
    <result column="PostType" jdbcType="INTEGER" property="posttype" />
    <result column="UserNo" jdbcType="VARCHAR" property="userno" />
    <result column="PostTitle" jdbcType="VARCHAR" property="posttitle" />
    <result column="PostDetail" jdbcType="VARCHAR" property="postdetail" />
    <result column="ImgUrl" jdbcType="VARCHAR" property="imgurl" />
    <result column="Goods" jdbcType="INTEGER" property="goods" />
    <result column="Bads" jdbcType="INTEGER" property="bads" />
    <result column="Time" jdbcType="TIMESTAMP" property="time" />
    <result column="Status" jdbcType="VARCHAR" property="status" />
    <result column="userName" jdbcType="VARCHAR" property="userName" />
  </resultMap>

    <resultMap id="BaseResultMap1" type="com.example.campus.entity.PostDo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    <id column="PostId" jdbcType="INTEGER" property="postid" />
    <result column="PostType" jdbcType="INTEGER" property="posttype" />
    <result column="UserNo" jdbcType="VARCHAR" property="userno" />
    <result column="PostTitle" jdbcType="VARCHAR" property="posttitle" />
    <result column="PostDetail" jdbcType="VARCHAR" property="postdetail" />
    <result column="ImgUrl" jdbcType="VARCHAR" property="imgurl" />
    <result column="Goods" jdbcType="INTEGER" property="goods" />
    <result column="Bads" jdbcType="INTEGER" property="bads" />
    <result column="Time" jdbcType="TIMESTAMP" property="time" />
    <result column="Status" jdbcType="VARCHAR" property="status" />
    <result column="userName" jdbcType="VARCHAR" property="userName" />
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    <result column="Comments" jdbcType="LONGVARCHAR" property="comments" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    PostId, PostType, UserNo, PostTitle, PostDetail, ImgUrl, Goods, Bads, Time, Status
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    Comments
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from post
    where PostId = #{postid,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    delete from post
    where PostId = #{postid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    <selectKey keyProperty="postid" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into post (PostType, UserNo, PostTitle, 
      PostDetail, ImgUrl, Goods, 
      Bads, Time, Status, 
      Comments)
    values (#{posttype,jdbcType=INTEGER}, #{userno,jdbcType=VARCHAR}, #{posttitle,jdbcType=VARCHAR}, 
      #{postdetail,jdbcType=VARCHAR}, #{imgurl,jdbcType=VARCHAR}, #{goods,jdbcType=INTEGER}, 
      #{bads,jdbcType=INTEGER}, #{time,jdbcType=TIMESTAMP}, #{status,jdbcType=VARCHAR}, 
      #{comments,jdbcType=LONGVARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    <selectKey keyProperty="postid" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into post
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="posttype != null">
        PostType,
      </if>
      <if test="userno != null">
        UserNo,
      </if>
      <if test="posttitle != null">
        PostTitle,
      </if>
      <if test="postdetail != null">
        PostDetail,
      </if>
      <if test="imgurl != null">
        ImgUrl,
      </if>
      <if test="goods != null">
        Goods,
      </if>
      <if test="bads != null">
        Bads,
      </if>
      <if test="time != null">
        Time,
      </if>
      <if test="status != null">
        Status,
      </if>
      <if test="comments != null">
        Comments,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="posttype != null">
        #{posttype,jdbcType=INTEGER},
      </if>
      <if test="userno != null">
        #{userno,jdbcType=VARCHAR},
      </if>
      <if test="posttitle != null">
        #{posttitle,jdbcType=VARCHAR},
      </if>
      <if test="postdetail != null">
        #{postdetail,jdbcType=VARCHAR},
      </if>
      <if test="imgurl != null">
        #{imgurl,jdbcType=VARCHAR},
      </if>
      <if test="goods != null">
        #{goods,jdbcType=INTEGER},
      </if>
      <if test="bads != null">
        #{bads,jdbcType=INTEGER},
      </if>
      <if test="time != null">
        #{time,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="comments != null">
        #{comments,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    update post
    <set>
      <if test="posttype != null">
        PostType = #{posttype,jdbcType=INTEGER},
      </if>
      <if test="userno != null">
        UserNo = #{userno,jdbcType=VARCHAR},
      </if>
      <if test="posttitle != null">
        PostTitle = #{posttitle,jdbcType=VARCHAR},
      </if>
      <if test="postdetail != null">
        PostDetail = #{postdetail,jdbcType=VARCHAR},
      </if>
      <if test="imgurl != null">
        ImgUrl = #{imgurl,jdbcType=VARCHAR},
      </if>
      <if test="goods != null">
        Goods = #{goods,jdbcType=INTEGER},
      </if>
      <if test="bads != null">
        Bads = #{bads,jdbcType=INTEGER},
      </if>
      <if test="time != null">
        Time = #{time,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        Status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="comments != null">
        Comments = #{comments,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where PostId = #{postid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    update post
    set PostType = #{posttype,jdbcType=INTEGER},
      UserNo = #{userno,jdbcType=VARCHAR},
      PostTitle = #{posttitle,jdbcType=VARCHAR},
      PostDetail = #{postdetail,jdbcType=VARCHAR},
      ImgUrl = #{imgurl,jdbcType=VARCHAR},
      Goods = #{goods,jdbcType=INTEGER},
      Bads = #{bads,jdbcType=INTEGER},
      Time = #{time,jdbcType=TIMESTAMP},
      Status = #{status,jdbcType=VARCHAR},
      Comments = #{comments,jdbcType=LONGVARCHAR}
    where PostId = #{postid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.example.campus.entity.Post">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 10 22:24:16 CST 2020.
    -->
    update post
    set PostType = #{posttype,jdbcType=INTEGER},
      UserNo = #{userno,jdbcType=VARCHAR},
      PostTitle = #{posttitle,jdbcType=VARCHAR},
      PostDetail = #{postdetail,jdbcType=VARCHAR},
      ImgUrl = #{imgurl,jdbcType=VARCHAR},
      Goods = #{goods,jdbcType=INTEGER},
      Bads = #{bads,jdbcType=INTEGER},
      Time = #{time,jdbcType=TIMESTAMP},
      Status = #{status,jdbcType=VARCHAR}
    where PostId = #{postid,jdbcType=INTEGER}
  </update>

  <select id="selectAllPosts" resultType="com.example.campus.entity.Post">
      select * from post
  </select>

    <select id="selPostByType" resultMap="BaseResultMap1">
        select
            post.PostId,
            PostType,
            post.UserNo,
            PostTitle,
            PostDetail,
            ImgUrl,
            post.Goods,
            post.Bads,
            Time,
            Status,
            UserName                 as userName,
            count(comment.CommentId) as Comments
        from
            post
            join user
        on user.UserNo = post.userNo
           left join comment
           on comment.PostId = post.PostId
        where
            PostType = #{type}
        group by
            post.PostId
    </select>
</mapper>